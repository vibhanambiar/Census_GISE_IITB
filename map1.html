<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map Visualization</title>
     <link rel="stylesheet" href="https://spin.js.org/spin.css"/>
     <script src="https://spin.js.org/spin.umd.js"></script>
     <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous"> -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
    integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
    crossorigin=""/>
     <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
    integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
    crossorigin=""></script>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="static/html2pdf.js"></script>
    <script src="dist/leaflet.browser.print.min.js"></script>

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css" integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ==" crossorigin="">
     <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
   integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
   crossorigin=""></script>

    <style>
       
body {
  position: fixed;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  margin: 0;
  /* overflow: hidden; */
}
.full-height {
  height: 100%;
}

.header {
    height: 50px;
}

.leaflet-popup-content-wrapper {
    background: rgba(0, 0, 0, 0.9);
    color:#ffffff;
}

.leaflet-popup-content{
    font-weight: bold;
    font-size: 1000px;
}

.leaflet-tooltip.my-labels {
background-color: transparent;
border: transparent;
box-shadow: none;
}

.myAttributeTable{
  background-color: rgb(255, 255, 255);
  text-align: left;
  border-collapse: collapse;
  overflow-y: scroll; 
  max-height: 400px;
  max-width: 100%;
  /* position: fixed; */
  bottom: 0;
  right: 0;
}

 .main{
        margin: auto;
        height: 1024px;
        width: 1440px; 
        left: -1116px;
        top: -656px;
        border-radius: 0px;


    }
    .main .header{
        height: 110px;
         width: 1440px;
        padding-top: 20px;
        /* background-color: grey;  */
        display: flex;
        display: -webkit-flex;
        border: 2px;
        border-color: grey;
        
    }
    .main .header .sub_part1{
       height: 113px;
       width: 100px;
       left: 10px;
       top: 9px;
       border-radius: 18px;
       border-color: black;
       -webkit-box-flex: inherit;
       -ms-flex: 1;
       flex: 1;
   }  
   .header .sub_part2{
    height: 113px;
    width: 100px;
    left: 293px;
    top: 9px;
    border-radius: 18px;
      -webkit-box-flex: inherit;
       -ms-flex: 1;
       flex: 1;

   }
   .header .sub_part3{
    height: 113px;
      width: 100px;
    left: 580px;
    top: 9px;
    border-radius: 18px;
    -webkit-box-flex: inherit;
       -ms-flex: 1;
       flex: 1;


   }
   .header .sub_part4{
   height: 113px;
      width: 100px;
    left: 867px;
    top: 9px;
    border-radius: 18px;
    -webkit-box-flex: inherit;
       -ms-flex: 1;
       flex: 1;

   }

 .header .sub_part5{
    height: 113px;
     width: 100px;
    left: 1152px;
    top: 9px;
    border-radius: 18px;
    -webkit-box-flex: inherit;
       -ms-flex: 1;
       flex: 1;

 }
 #map{
    height: 500px;
    width: 500px;
    padding-left: 293px;
    /* top: 152px; */
    border-radius: 0px;
    border-color: black;
     display: flex;
     display: -webkit-flex;

 }
.map .details{
   box-sizing: border-box;
     padding-left: 1200px;
     top: 152px;
     -webkit-box-flex: inherit;
       -ms-flex: 1;
       flex: 1;
}
</style>
</style>
</head>

<body>
    
<div class="main">
<div class="navbar">
  <div class="header">
    <!-- Select Area -->
   <div class="sub_part1">
    <div>
      <fieldset>
      <legend><b>Select Area</b></legend>
      <div>
        <input type="radio" id="dist" name="layer" value="district"
             checked onchange="handleClick();"><label><b>District</b></label>
      </div>

      <div>
        <input type="radio" id="taluka" name="layer" value="taluka" onclick="handleClick();"><label><b>Taluka</b></label>
      </div>

      <div>
        <input type="radio" id="village" name="layer" value="village" onclick="handleClick();"><label><b>Village</b></label>
      </div>
     </fieldset>
    </div>
   </div>
    
    <!-- Select Sub Area -->
   <div class="sub_part2">
    <div>
     <fieldset>
     <legend><b>Select  Sub Area</b></legend>
     <div>
        <input type="radio" id="dist" name="subArea" value="district"
             checked onchange="handleClick();"><label><b>District</b></label>
     </div>

     <div>
        <input type="radio" id="taluka" name="subArea" value="taluka" onclick="handleClick();"><label><b>Taluka</b></label>
     </div>

     <div>
        <p></p>
     </div>
     </fieldset>
   </div>
   </div>

   <!-- sub type -->
   <div class="sub_part3">
    <div>
     <fieldset>
     <legend><b>Select Type</b></legend>
     <div>
        <input type="radio" id="household" name="type" value="household"
             checked onchange="handleClick();">
        <label><b>Household</b></label>
     </div>
     <div>
        <input type="radio" id="demography" name="type" value="demography" onclick="handleClick();">
        <label><b>Demography</b></label>
     </div>
     <div>
        <p></p>
     </div>
     </fieldset>
   </div>
   </div>

   <!-- Select Caste -->
<div class="sub_part4">
    <div>
     <fieldset>
     <legend><b>Select Caste</b></legend>
     <div>
        <input type="radio" id="general" name="caste" value="general" checked onchange="handleClick();">
        <label><b>General</b></label>
     </div>
     <div>
        <input type="radio" id="sc" name="caste" value="sc" onclick="handleClick();">
        <label><b>SC</b></label>
     </div>
     <div>
        <input type="radio" id="st" name="caste" value="st" onclick="handleClick();">
        <label><b>ST</b></label>
     </div>
     </fieldset>
   </div>
   </div>
   
     <!-- Select Region -->
<div class="sub_part5">
    <div>
     <fieldset>
     <legend><b>Select Region</b></legend>
     <div>
        <input type="radio" id="total" name="region" value="total"
             checked onchange="handleClick();">
        <label><b>Total</b></label>
     </div>
     <div>
        <input type="radio" id="urban" name="region" value="urban" onclick="handleClick();">
        <label><b>Urban</b></label>
     </div>
     <div>
        <input type="radio" id="rural" name="region" value="rural" onclick="handleClick();">
        <label><b>Rural</b></label>
     </div>
     </fieldset>
   </div>
   </div>
   </ul>
   </div>
    </div> 
<!-- Map -->
<div class="container" style="display:grid;grid-template-columns:60% 40%">
  <div class="sidebar">
          <div class="details">

           </div>
      <div id="map">
      <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
        integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
        crossorigin=""></script>
        <script>
            var map = L.map('map').setView([19.453280, 75.300293], 6.5);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: 'Â©OpenStreetMap'
            }).addTo(map);

            L.tileLayer.wms('https://geoserver2.communitygis.net/geoserver/wms?',{
                layers:'geonode:states_in_india',
                format:'image/png',
                transparent:'true',
                cql_filter:"state='Maharashtra'",
            }).addTo(map)

            // //Maharastra_Households_Taluka_Lavel_Cencus
            // fetch('https://geonode.communitygis.in/geoserver/geonode/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geonode%3AMaharastra_Households_Taluka_Lavel_Cencus_201&outputFormat=application%2Fjson')
            // .then(result=>result.json())
            // .then((output)=>{
            //     wmsLayer = L.geoJson(output,{
            //         onEachFeature:function(feature,layer){
            //             // console.log(feature.properties)
            //             // document.getElementById('ttt').innerHTML=feature.properties.taluka_nam
                        
            //         },
                    
            //     })
            //     wmsLayer.addTo(map)
            //     wmsLayer.on('click',function(e){
            //         // console.log(e.layer.feature.properties.taluka_nam)
            //         // document.getElementById('ttt').innerHTML='District: '+e.layer.feature.properties.taluka_nam
            //     })
            //     console.log(wmsLayer)
            //     // wmsLayer.on('click',function(feature,layer){
            //     //     // console.log(feature.properties)
            //     // })
            // })

            //SC_Taluka_Lavel_Rural

            //  fetch('https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ASC_Taluka_Lavel_Rural&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326')
            // .then(result=>result.json())
            // .then((output)=>{
            //     wmsLayer = L.geoJson(output,{
            //         onEachFeature:function(feature,layer){
            //             // console.log(feature.properties)
            //             document.getElementById('ttt').innerHTML=feature.properties.taluka_nam
                        
            //         },
            //     })
            //     wmsLayer.addTo(map)
            //     wmsLayer.on('click',function(e){
            //         // console.log(e.layer.feature.properties.taluka_nam)
            //         document.getElementById('ttt').innerHTML='District: '+e.layer.feature.properties.taluka_nam
            //     })
            //     console.log(wmsLayer)
            //     // wmsLayer.on('click',function(feature,layer){
            //     //     // console.log(feature.properties)
            //     // })
            // })








            // fetch('https://geonode.communitygis.in/geoserver/geonode/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=geonode%3Aawc1&outputFormat=application%2Fjson')
          // .then(result=>result.json())
          // .then((output)=>{
          //   wms_layer1 = L.geoJson(output,{
          //     onEachFeature: function(feature, layer){
          //       layer.bindPopup(`<div >Beat No: ${feature.properties.beat_no}<br>Population: ${feature.properties.population}<br>Males: ${feature.properties.males}<br>Females: ${feature.properties.females}  </div>`)
          //     },
          //     filter: function(feature, layer){
          //       for(i of t){
          //         if(feature.properties.beat_no == i){
          //           return feature.properties.beat_no;
          //         }
          //       }
          //     }

          //   })
          //   wms_layer1.addTo(mymap)
          //   points.push(wms_layer1);
          // })
      
        </script>
        </div> -->
        </div>
 

</div>
</body>
<script>
    let geonodeDomain = "maha.geonode.communitygis.in"
    var map; 
    map = L.map('map').setView([19.0760, 75.8777], 7);
    let activatedLayer = null;
    var tiles = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		id: 'mapbox/streets-v11',
		tileSize: 512,
		zoomOffset: -1
	}).addTo(map);
    
// district - household 
   let url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Households_District_Level_Census_0&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326"
   let currentData = null;
   let selectedAttribute,layer;

   var operators = {
        '>': function(a, b){ if(a>b) return true;else return false},
        '<': function(a, b){ if(a<b) return true;else return false},
        '>=': function(a, b){ if(a>=b) return true;else return false},
        '<=': function(a, b){ if(a<=b) return true;else return false}
}

    // adding control for table

    var attribute_table = L.control();

    let div = L.DomUtil.create('div', 'myAttributeTable'); // create a div with a class "info"
    attribute_table.onAdd = function (map) {
    div.innerHTML = 'Hover over a state';

    return div;
    };


    function create_property_json(feature,selectedAttribute,heirarchy){
    var json_props = [];
    feature.forEach(feat => {
        // let temp = {"dist_name" : feat.properties['dist_name']}
        let temp = {[heirarchy] : feat.properties[heirarchy],[selectedAttribute] : feat.properties[selectedAttribute]}
        json_props.push(temp);
    });
    return(json_props);
    
}
    let table;
    function updateTable(currentData,selectedAttribute,layer='district'){
    div.innerHTML = '';
    // console.log(currentData,selectedAttribute)

    let heirarchy = (layer === "district")?"dist_name":"taluka_nam";

    var propsJSON = create_property_json(currentData.features,selectedAttribute,heirarchy);
    var col = [heirarchy,selectedAttribute];
    // for (var i = 0; i < propsJSON.length; i++) {
    //     for (var key in propsJSON[i]) {
    //         if (col.indexOf(key) === -1) {
    //             col.push(key);
    //         }
    //     }
    // }

    table = document.createElement("table");
    var tr = table.insertRow(-1);                   
    for (var i = 0; i < col.length; i++) {
        var th = document.createElement("th");      
        th.innerHTML = col[i];
        tr.appendChild(th);
    }
    for (var i = 0; i < propsJSON.length; i++) {

    tr = table.insertRow(-1);

    for (var j = 0; j < col.length; j++) {
        var tabCell = tr.insertCell(-1);
        tabCell.innerHTML = propsJSON[i][col[j]];
    }
    }

    div.appendChild(table);




    }

    function export_table_to_csv(html, filename) {
	var csv = [];
	var rows = html.querySelectorAll("table tr");
	
    for (var i = 0; i < rows.length; i++) {
		var row = [], cols = rows[i].querySelectorAll("td, th");
		
        for (var j = 0; j < cols.length; j++) 
            row.push(cols[j].innerText);
        
		csv.push(row.join(","));		
	}

    download_csv(csv.join("\n"), filename);
}

function download_csv(csv, filename) {
    var csvFile;
    var downloadLink;

    // CSV FILE
    csvFile = new Blob([csv], {type: "text/csv"});

    // Download link
    downloadLink = document.createElement("a");

    // File name
    downloadLink.download = filename;

    // We have to create a link to the file
    downloadLink.href = window.URL.createObjectURL(csvFile);

    // Make sure that the link is not displayed
    downloadLink.style.display = "none";

    // Add the link to your DOM
    document.body.appendChild(downloadLink);

    // Lanzamos
    downloadLink.click();
}

   function downloadtable(){
       export_table_to_csv(table, "data.csv");
   }
    attribute_table.addTo(map);


   function fetchData(myurl){
    // map.spin(true,{lines: 9, length: 2, width: 20, scale: 60,radius: 70, color: "grey"});
    let variable = document.getElementById("variable");
        variable.value = ""
    fetch(myurl)
        .then(response => response.json())
        .then(data => {
            if(typeof selectedAttribute === 'undefined')
                selectedAttribute = Object.keys(data.features[0].properties)[0] //random attribute name

            currentData = data;
            renderLayer(data,selectedAttribute,'>',0,"shiny grey")
            updateTable(currentData,selectedAttribute,layer)

        
        });
    // map.spin(false);

   }

   function executequery(){
        let op = document.getElementById('op').value
        let colr = document.getElementById('color').value
        let variable= document.getElementById('variable').value
        renderLayer(currentData,selectedAttribute,op,variable,colr)
}

   function renderLayer(data,selectedAttribute,op,variable,colorvalue){
    if(activatedLayer){
        map.removeLayer(activatedLayer);
        
    }

    function getRange(data){
        let range = d3.extent(data.map(d => d.properties[selectedAttribute]))
        return range
    }
    let range = getRange(data.features)
    document.getElementById("show-range").innerHTML = "Range: "+range[0] + "-" +range[1];
    document.getElementById("show-selected-attribute").innerHTML = "Selected Attribute:" + selectedAttribute;


    // var color_sequential = d3.scaleSequential(d3.interpolateGreens).domain(range);
    function style(feature) {
    let attrValue = feature.properties[selectedAttribute];
    let color;
    


    // if(attrValue <=0 || typeof attrValue === "undefined") color = 'grey';
    // else color = colorvalue

    // if(operators[op](attrValue,variable)){
    //     return colorvalue
    // }else return "grey";

    if(operators[op](attrValue,variable)){
        color = colorvalue
    }
    else{
        color = "grey"
    }
    return {
        fillColor:color,
        weight: 2,
        opacity: 1,
        color: 'black',
        dashArray: '3',
        fillOpacity: 0.7
    };
}

function onEachFeature(feature, layer) {

    layer.bindTooltip("<div style = 'text-transform: capitalize'>"+feature.properties[selectedAttribute]+"</div>",{permanent: true, 
   direction: "center",
   className: "my-labels"});
}



    activatedLayer =  L.geoJSON(data,{style: style,onEachFeature:onEachFeature}).addTo(map);
   }
   fetchData(url)
      var wmsLayer;
    function handleClick(){
        let layer = document.querySelector('input[name="layer"]:checked').value;
        let type = document.querySelector('input[name="type"]:checked').value;
        let caste = document.querySelector('input[name="caste"]:checked').value;
        let region = document.querySelector('input[name="region"]:checked').value;

        let scST = document.getElementById("sc-st");
        let ruralUrban = document.getElementById("rural-urban");

        // if(layer === 'taluka' && type === 'household'){
        //     // if(!document.getElementById('total').checked){
        //         // document.getElementById('total').checked = true;
        //         // handleClick() // hack
        //     // }
        //     // ruralUrban.style.display = "none";
        // }else if(layer === 'taluka' && type === 'demography'){
        //     // if(!document.getElementById('total').checked && !document.getElementById('general').checked){
        //         // document.getElementById('general').checked = true;
        //         // document.getElementById('total').checked = true;
        //         // handleClick() // hack
        //     // }
        //     // scST.style.display = "none";
        //     // ruralUrban.style.display = "none";
        // }else if(layer === 'district' && type === 'demography'){
        //     // document.getElementById('general').checked = true;
        //     // document.getElementById('total').checked = true;
        //     // scST.style.display = "none";
        //     // ruralUrban.style.display = "none";
        // }else if(layer === 'district' && type === 'household'){
        //     // scST.style.display = "block";
        //     // ruralUrban.style.display = "block";
        // }
    

        if(layer === "village"){
            if(wmsLayer){
              map.removeLayer(wmsLayer)
              }
                wmsLayer = L.tileLayer.wms('https://maha.geonode.communitygis.in/geoserver/wms?', {
                format: 'image/png',
                transparent: true,
                layers: 'geonode:Demographic_Village_Level_Total'
            }).addTo(map);
        }
        else if(layer === "taluka"){
             if(wmsLayer){
              map.removeLayer(wmsLayer)
              }
                wmsLayer = L.tileLayer.wms('https://maha.geonode.communitygis.in/geoserver/wms?', {
                format: 'image/png',
                transparent: true,
                layers: 'geonode:Households_General_Taluka_Lavel_Urban'
            }).addTo(map);

        } 
         else if(layer === "district"){
             if(wmsLayer){
              map.removeLayer(wmsLayer)
              }
              wmsLayer = L.tileLayer.wms('https://maha.geonode.communitygis.in/geoserver/wms?', {
                format: 'image/png',
                transparent: true,
                layers: 'geonode:District_Level_Demographics_Urban'
            }).addTo(map);
        }  

        if(type=='demography') scST.style.display = "none";
        else scST.style.display = "block";

        let url = "";
        if(layer==='district' && type === 'demography' && caste === 'general' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_District_Level_Total_Demo&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'demography' && caste === 'general' && region === 'rural') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ADistrict_Level_Demographics_Rural&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='district' && type === 'demography' && caste === 'general' && region === 'urban') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ADistrict_Level_Demographics_Urban&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";

        
        else if(layer==='district' && type === 'household' && caste === 'general' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Households_District_Level_Census_0&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'household' && caste === 'general' && region === 'rural') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_District_Level_Rural_Hous&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'household' && caste === 'general' && region === 'urban') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_District_Level_Urban_Hous&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        
        else if(layer==='district' && type === 'household' && caste === 'sc' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_To&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'household' && caste === 'sc' && region === 'rural') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_Ru&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'household' && caste === 'sc' && region === 'urban') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_Ur&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        
        
        else if(layer==='district' && type === 'household' && caste === 'st' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_To&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'household' && caste === 'st' && region === 'rural') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_District_Level_Ru&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='district' && type === 'household' && caste === 'st' && region === 'urban') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_District_Level_Ur&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";

        else if(layer==='taluka' && type === 'demography' && caste === 'general' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_Taluka_Level_Total_Demogr&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='taluka' && type === 'demography' && caste === 'general' && region === 'rural') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ATaluka_Level_Demographics_Rural&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'demography' && caste === 'general' && region === 'urban') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ATaluka_Level_Demographics_Urban&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";

        else if(layer==='taluka' && type === 'household' && caste === 'general' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharastra_Households_Taluka_Lavel_Cencus_201&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='taluka' && type === 'household' && caste === 'general' && region === 'rural') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AHouseholds_General_Taluka_Lavel_Rural&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'household' && caste === 'general' && region === 'urban') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AHouseholds_General_Taluka_Lavel_Urban&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";

        else if(layer==='taluka' && type === 'household' && caste === 'sc' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_Taluka_Level_Tota&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='taluka' && type === 'household' && caste === 'sc' && region === 'rural') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ASC_Taluka_Lavel_Rural&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'household' && caste === 'sc' && region === 'urban') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ASC_Taluka_Lavel_Urban&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";

        else if(layer==='taluka' && type === 'household' && caste === 'st' && region === 'total') url = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_Taluka_Level_Tota&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326";
        else if(layer==='taluka' && type === 'household' && caste === 'st' && region === 'rural') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AST_Taluka_Lavel_Rural&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'household' && caste === 'st' && region === 'urban') url = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AST_Taluka_Lavel_Urban&outputFormat=json&srs=EPSG%3A4326&srsName=EPSG%3A4326&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";


        fetchData(url)
        toggleDropdown(type);


    }
    
    let householdDiv = document.getElementById("household-dropdown");
    let demographyDiv = element = document.getElementById("demography-dropdown");
    householdDiv.style.display = "block";
    demographyDiv.style.display = "none";
    function toggleDropdown(selectedType){

        if(selectedType === 'household') {
            householdDiv.style.display = "block";
            demographyDiv.style.display = "none";
        }
        else if(selectedType === 'demography') {
            householdDiv.style.display = "none";
            demographyDiv.style.display = "block";
        }
    }
    function downloadURI(uri, name) {
        var link = document.createElement("a");
        link.download = name;
        link.href = uri;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        delete link;
    }

    function downloadShapefile(){
        let layer = document.querySelector('input[name="layer"]:checked').value;
        let type = document.querySelector('input[name="type"]:checked').value;
        let caste = document.querySelector('input[name="caste"]:checked').value;
        let region = document.querySelector('input[name="region"]:checked').value;

        let uri = "";
        if(layer==='district' && type === 'demography' && caste === 'general' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_District_Level_Total_Demo&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'demography' && caste === 'general' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ADistrict_Level_Demographics_Rural&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='district' && type === 'demography' && caste === 'general' && region === 'urban') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ADistrict_Level_Demographics_Urban&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        
        
        else if(layer==='district' && type === 'household' && caste === 'general' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Households_District_Level_Census_0&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'household' && caste === 'general' && region === 'rural') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_District_Level_Rural_Hous&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'household' && caste === 'general' && region === 'urban') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_District_Level_Urban_Hous&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        
        
        else if(layer==='district' && type === 'household' && caste === 'sc' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_To&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'household' && caste === 'sc' && region === 'rural') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_Ru&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'household' && caste === 'sc' && region === 'urban') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_District_Level_Ur&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";

        else if(layer==='district' && type === 'household' && caste === 'st' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_District_Level_To&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'household' && caste === 'st' && region === 'rural') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_District_Level_Ru&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='district' && type === 'household' && caste === 'st' && region === 'urban') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_District_Level_Ur&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";

        else if(layer==='taluka' && type === 'demography' && caste === 'general' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_General_Taluka_Level_Total_Demogr&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='taluka' && type === 'demography' && caste === 'general' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ATaluka_Level_Demographics_Rural&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'demography' && caste === 'general' && region === 'urban') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ATaluka_Level_Demographics_Urban&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        
        else if(layer==='taluka' && type === 'household' && caste === 'general' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharastra_Households_Taluka_Lavel_Cencus_201&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='taluka' && type === 'household' && caste === 'general' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AHouseholds_General_Taluka_Lavel_Rural&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'household' && caste === 'general' && region === 'urban') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AHouseholds_General_Taluka_Lavel_Urban&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";

        else if(layer==='taluka' && type === 'household' && caste === 'sc' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Caste_Taluka_Level_Tota&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='taluka' && type === 'household' && caste === 'sc' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ASC_Taluka_Lavel_Rural&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'household' && caste === 'sc' && region === 'urban') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ASC_Taluka_Lavel_Urban&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        
        else if(layer==='taluka' && type === 'household' && caste === 'st' && region === 'total') uri = "https://" + geonodeDomain + "/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AMaharashtra_Scheduled_Tribe_Taluka_Level_Tota&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8";
        else if(layer==='taluka' && type === 'household' && caste === 'st' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AST_Taluka_Lavel_Rural&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='taluka' && type === 'household' && caste === 'st' && region === 'urban') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AST_Taluka_Lavel_Urban&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";


        else if(layer==='village' && type === 'demography' && caste === 'general' && region === 'total') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ADemographic_Village_Level_Total&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='village' && type === 'demography' && caste === 'general' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3ADemographic_Village_Level_Total&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";

        else if(layer==='village' && type === 'household' && caste === 'general' && region === 'total') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AHouseholds_Village_Level_Total&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";
        else if(layer==='village' && type === 'household' && caste === 'general' && region === 'rural') uri = "https://maha.geonode.communitygis.in/geoserver/ows?service=WFS&version=1.0.0&request=GetFeature&typename=geonode%3AHouseholds_Village_Level_Total&outputFormat=SHAPE-ZIP&srs=EPSG%3A4326&format_options=charset%3AUTF-8&access_token=FS1sGMwrAEz4FuOmXUDMGTGAcuXxEh";


        downloadURI(uri, "shapefile.shp");

    }
 // populate dropdown
 let household_description =  "https://raw.githubusercontent.com/debabrata-mallick/GISE-Tool-for-Visualization-of-Census-Data/main/household.json";
 let demography_description = "https://raw.githubusercontent.com/debabrata-mallick/GISE-Tool-for-Visualization-of-Census-Data/main/demography.json";
// household
 fetch(household_description)
  .then(response => response.json())
  .then(attr_list => {
    var select = document.getElementById("attr-dropdown-household");
    attr_list.map(d =>{
        select.options[select.options.length] = new Option(d.full_description,d.short_form);
      })
  });

  function handleDropdownChangeHousehold(){
        selectedAttribute = document.getElementById("attr-dropdown-household").value;
        let variable = document.getElementById("variable");
        variable.value = ""
        renderLayer(currentData,selectedAttribute,'>',0,"grey")
        updateTable(currentData,selectedAttribute,layer)
  }


  // demography

  fetch(demography_description)
  .then(response => response.json())
  .then(attr_list => {
    var select = document.getElementById("attr-dropdown-demography");
    attr_list.map(d =>{
        select.options[select.options.length] = new Option(d.full_description,d.short_form);
      })
  });

  function handleDropdownChangeDemography(){
      
      selectedAttribute = document.getElementById("attr-dropdown-demography").value;
      let variable = document.getElementById("variable");
        variable.value = ""
        renderLayer(currentData,selectedAttribute,'>',0,"grey")
        updateTable(currentData,selectedAttribute,layer)

  }
  function generatePDF() {
				// Choose the element that our invoice is rendered in.
				const element = document.getElementById('test');
                console.log(element)
				// Choose the element and save the PDF for our user.
				html2pdf().from(element).save();
			}

    var browserControl = L.control.browserPrint({documentTitle:"Census Map",title:'print Map',printModes:["Portrait", "Landscape", "Auto"]}).addTo(map);

</script>

</html>